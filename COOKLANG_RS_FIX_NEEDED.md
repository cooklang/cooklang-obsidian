# Fixes Needed in cooklang-rs for NPM Package

## Current Issue

The `@cooklang/cooklang-ts` package cannot be used directly from NPM because it distributes **TypeScript source files** instead of compiled JavaScript.

## Problem 1: TypeScript Source in Main Entry Point ✅ (FIXED)

**File:** `typescript/package.json`

**Issue:** Missing `pkg/cooklang_wasm_bg.js` from the files array
- This file contains the JavaScript glue code generated by wasm-bindgen
- Without it, the WASM module cannot be initialized

**Status:** ✅ **FIXED in commit 9b3aeb8**

The `pkg/cooklang_wasm_bg.js` file is now included in the package.

## Problem 2: Main Entry Points to TypeScript ❌ (STILL NEEDS FIX)

**File:** `typescript/package.json`

**Current:**
```json
{
  "main": "index.ts"
}
```

**Issue:**
- The main entry point is a TypeScript file
- When consumers import from `@cooklang/cooklang-ts`, their build tools try to load `index.ts`
- Most bundlers (like rollup) expect JavaScript, not TypeScript
- This causes parse errors: "Expected ';', '}' or <eof> (Note that you need plugins to import files that are not JavaScript)"

**Solution Options:**

### Option A: Compile to JavaScript (Recommended)
1. Add a build step to compile TypeScript to JavaScript
2. Update package.json:
```json
{
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "files": [
    "dist/",
    "pkg/cooklang_wasm_bg.wasm",
    "pkg/cooklang_wasm_bg.js",
    "pkg/cooklang_wasm.d.ts",
    "pkg/cooklang_wasm.js"
  ],
  "scripts": {
    "build": "tsc",
    "build-wasm": "wasm-pack build --target bundler",
    "prepare": "npm run build-wasm && npm run build"
  }
}
```

3. Add `tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "declaration": true,
    "outDir": "./dist",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node"
  },
  "include": ["index.ts"],
  "exclude": ["node_modules", "pkg"]
}
```

### Option B: Use .mjs Extension
Change the file extension from `.ts` to `.mjs` and write in JavaScript with JSDoc types:
```json
{
  "main": "index.mjs",
  "types": "index.d.ts"
}
```

But this requires rewriting the TypeScript code to JavaScript.

## Why This Matters

TypeScript is a development-time language that needs to be compiled to JavaScript for distribution. Publishing TypeScript source files assumes:
1. All consumers have TypeScript in their build pipeline
2. All consumers have configured their tools to compile `node_modules` (which is uncommon)
3. The package's TypeScript version matches the consumer's (version incompatibilities can cause issues)

**Best practice:** Always publish compiled JavaScript along with type definitions.

## Current Workaround

The Obsidian plugin currently uses locally built WASM files in `src/parser/` instead of the NPM package. This works but means:
- The package can't be easily upgraded
- Changes require rebuilding from source
- The integration is less maintainable

## Testing the Fix

Once fixed, the package can be tested with:
```bash
npm install @cooklang/cooklang-ts@latest
# Should work without needing local files
```

## Summary

To make `@cooklang/cooklang-ts` usable as a standard NPM package:
1. ✅ Include `pkg/cooklang_wasm_bg.js` in files array **(DONE)**
2. ❌ Compile TypeScript to JavaScript before publishing **(NEEDS FIX)**
3. ❌ Point main to compiled .js file **(NEEDS FIX)**
4. ❌ Include type definitions (.d.ts) for TypeScript users **(NEEDS FIX)**
